/**
 * Raft Raft
 *
 */

var EventEmitter2 = require('eventemitter2').EventEmitter2;
var metric = require('metrics-server').metric;
var usage = require('usage');

module.exports = new EventEmitter2();
module.exports.common = require('./lib/raft/common');
module.exports.start = require('./lib/raft/start');

module.exports.metrics = function(session, pid, checkInterval) {
	var memory = metric.createMetric(module.exports.config.get('metric'));

	var cpu = metric.createMetric(module.exports.config.get('metric'));

	memory.interval = cpu.interval = false;
	memory.token = cpu.token = session;

	memory.name = 'memory';
	cpu.name = 'cpu';

	var timmer = setInterval(function() {

		usage.lookup(pid, {
			keepHistory : true
		}, function(err, result) {
			memory.cb(result.memory);
			cpu.cb(result.cpu);
		});
	}, checkInterval || 1000);

	memory.start();
	cpu.start();

	return {
		memory : memory,
		cpu : cpu,
		stop : function() {
			clearInterval(timmer);
		}
	};
};
