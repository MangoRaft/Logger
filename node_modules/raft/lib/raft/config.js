/*
 *
 * (C) 2013, MangoRaft.
 *
 */
var nconf = require('nconf');
var raft = require('../../');

module.exports.load = function() {
	nconf.use('memory');
	var replyEvent = raft.common.uuid(true);
	function loadConfig(config) {
		var keys = Object.keys(config);
		keys.forEach(function(key) {
			nconf.set(key, config[key]);
		});
		raft.emit('config');
	}

	var sidreply = raft.nats.subscribe(replyEvent, loadConfig);
	raft.nats.publish('config.load', {}, replyEvent);
	raft.nats.subscribe('config.reload', loadConfig);
	raft.config = nconf;
};
